<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>–¢–µ–Ω–Ω–∏—Å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
<style>
:root{--bg-primary:#1a1a2e;--bg-secondary:#16213e;--accent:#4cc9f0;--accent-dark:#4361ee;--text-primary:#e6e6e6;--text-secondary:#a0a0a0;--card-bg:#0f3460;--input-bg:#1f4068;--success:#4ade80;--danger:#f87171;--warning:#fbbf24;--transition:all 0.3s ease}
[data-theme="light"]{--bg-primary:#f0f4f8;--bg-secondary:#d9e2ec;--accent:#3b82f6;--accent-dark:#2563eb;--text-primary:#1e293b;--text-secondary:#64748b;--card-bg:#ffffff;--input-bg:#f1f5f9;--success:#22c55e;--danger:#ef4444;--warning:#f59e0b}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,var(--bg-primary),var(--bg-secondary));color:var(--text-primary);min-height:100vh;padding:10px;transition:var(--transition)}
.container{max-width:800px;margin:0 auto;padding-bottom:10px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:5px 0}
h1{font-size:1.3rem;background:linear-gradient(to right,var(--accent),var(--accent-dark));-webkit-background-clip:text;background-clip:text;color:transparent;padding:5px 0}
.theme-switch{position:relative;display:inline-block;width:50px;height:25px}
.theme-switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--input-bg);transition:var(--transition);border-radius:30px}
.slider:before{position:absolute;content:"";height:19px;width:19px;left:3px;bottom:3px;background:linear-gradient(45deg,#ff9a9e,#fad0c4);transition:var(--transition);border-radius:50%}
input:checked+.slider{background-color:var(--accent-dark)}
input:checked+.slider:before{transform:translateX(25px);background:linear-gradient(45deg,#4facfe,#00f2fe)}
.card{background:var(--card-bg);border-radius:8px;padding:12px;margin-bottom:12px;box-shadow:0 3px 8px rgba(0,0,0,0.2);border:1px solid rgba(76,201,240,0.1)}
.card-title{font-size:1.1rem;margin-bottom:8px;color:var(--accent);display:flex;align-items:center}
.card-title i{margin-right:5px}
.input-group{margin-bottom:8px}
.input-group label{display:block;margin-bottom:3px;color:var(--text-secondary);font-size:0.85rem}
select,input{width:100%;padding:8px 10px;background:var(--input-bg);border:1px solid rgba(76,201,240,0.3);border-radius:6px;color:var(--text-primary);font-size:0.9rem}
select:focus,input:focus{border-color:var(--accent);outline:none}
.keyboard{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:8px}
.key{background:var(--input-bg);border:1px solid rgba(76,201,240,0.3);border-radius:6px;padding:8px;text-align:center;cursor:pointer;font-size:0.9rem;user-select:none}
.key:hover{background:rgba(76,201,240,0.2)}
.reset-key{grid-column:span 3;background:rgba(239,68,68,0.2);border-color:rgba(239,68,68,0.3)}
.btn{background:linear-gradient(to right,var(--accent),var(--accent-dark));color:white;border:none;padding:10px;border-radius:6px;cursor:pointer;width:100%;font-size:0.95rem;margin-top:8px}
.results-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
.result-card{background:var(--input-bg);border-radius:6px;padding:12px;text-align:center;border:1px solid transparent}
.result-card.value{border-color:var(--success)}
.result-card.no-value{border-color:var(--danger)}
.result-card.neutral{border-color:var(--warning)}
.result-title{font-size:0.85rem;margin-bottom:8px;color:var(--text-secondary)}
.result-value{font-size:1.2rem;font-weight:700;margin-bottom:5px}
.result-prob{font-size:1rem;font-weight:700;color:var(--accent);margin-bottom:5px}
.prob-bar{height:8px;background:rgba(255,255,255,0.1);border-radius:4px;margin-top:8px;overflow:hidden}
.prob-fill{height:100%;background:linear-gradient(to right,var(--accent),var(--accent-dark));border-radius:4px}
.recommendation{background:rgba(76,201,240,0.1);border-left:3px solid var(--accent);padding:10px;border-radius:0 6px 6px 0;margin-top:12px;font-size:0.9rem;line-height:1.5}
.score-inputs{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center}
.score-separator{font-size:1.5rem;font-weight:bold;color:var(--accent)}
.input-row{display:flex;gap:10px}
.input-row .input-group{flex:1}
@media (max-width:768px){.results-grid{grid-template-columns:1fr}.input-row{flex-direction:column;gap:8px}.card-title{font-size:1rem}.result-title{font-size:0.8rem}.result-value{font-size:1.1rem}.recommendation{font-size:0.85rem}}
</style>
</head>
<body>
<div class="container">
<header>
    <h1>üéæ –¢–µ–Ω–Ω–∏—Å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
    <label class="theme-switch"><input type="checkbox" id="theme-toggle"><span class="slider"></span></label>
</header>

<div class="card">
    <div class="card-title">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    <div class="input-group">
        <label for="inputType">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</label>
        <select id="inputType">
            <option value="points">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—á–∫–∞—Ö</option>
            <option value="games">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ –≥–µ–π–º–∞—Ö</option>
        </select>
    </div>
    
    <div id="pointsInput">
        <div class="input-row">
            <div class="input-group">
                <label for="p1Serve">–ò–≥—Ä–æ–∫ 1 (–ø–æ–¥–∞—á–∞)</label>
                <input type="number" id="p1Serve" min="0" max="1" step="0.01" value="0.65">
            </div>
            <div class="input-group">
                <label for="p2Serve">–ò–≥—Ä–æ–∫ 2 (–ø–æ–¥–∞—á–∞)</label>
                <input type="number" id="p2Serve" min="0" max="1" step="0.01" value="0.65">
            </div>
        </div>
    </div>
    
    <div id="gamesInput" style="display:none;">
        <div class="input-row">
            <div class="input-group">
                <label for="pg1">–ò–≥—Ä–æ–∫ 1 (–≥–µ–π–º)</label>
                <input type="number" id="pg1" min="0" max="1" step="0.01" value="0.83">
            </div>
            <div class="input-group">
                <label for="pg2">–ò–≥—Ä–æ–∫ 2 (–≥–µ–π–º)</label>
                <input type="number" id="pg2" min="0" max="1" step="0.01" value="0.83">
            </div>
        </div>
    </div>
    
    <div class="input-group">
        <label>–°—á—ë—Ç (–≥–µ–π–º—ã)</label>
        <div class="score-inputs">
            <input type="text" id="score1" value="7" class="score-input" readonly>
            <div class="score-separator">:</div>
            <input type="text" id="score2" value="6" class="score-input" readonly>
        </div>
    </div>
    
    <div class="keyboard">
        <div class="key" data-value="0">0</div>
        <div class="key" data-value="1">1</div>
        <div class="key" data-value="2">2</div>
        <div class="key" data-value="3">3</div>
        <div class="key" data-value="4">4</div>
        <div class="key" data-value="5">5</div>
        <div class="key" data-value="6">6</div>
        <div class="key" data-value="7">7</div>
        <div class="key" data-value="8">8</div>
        <div class="key" data-value="9">9</div>
        <div class="key reset-key" id="resetScore">–°–±—Ä–æ—Å</div>
    </div>
    
    <button id="calculateBtn" class="btn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<div class="card">
    <div class="card-title">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
    <div id="results">
        <div class="results-grid">
            <div class="result-card value">
                <div class="result-title">–¢–æ—Ç–∞–ª 17.5</div>
                <div class="result-value">86.4%</div>
                <div class="result-prob">–ö—ç—Ñ: 1.16</div>
                <div class="prob-bar"><div class="prob-fill" style="width:86%"></div></div>
            </div>
            <div class="result-card value">
                <div class="result-title">–¢–æ—Ç–∞–ª 18.5</div>
                <div class="result-value">72.1%</div>
                <div class="result-prob">–ö—ç—Ñ: 1.39</div>
                <div class="prob-bar"><div class="prob-fill" style="width:72%"></div></div>
            </div>
            <div class="result-card neutral">
                <div class="result-title">–¢–æ—Ç–∞–ª 19.5</div>
                <div class="result-value">53.8%</div>
                <div class="result-prob">–ö—ç—Ñ: 1.86</div>
                <div class="prob-bar"><div class="prob-fill" style="width:54%"></div></div>
            </div>
        </div>
        <div class="recommendation">
            <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ù–∞–∏–±–æ–ª—å—à–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å—Ç–∞–≤–∫–µ –Ω–∞ –¢–ë 19.5 - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 53.8% –ø—Ä–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–º –∫—ç—Ñ–µ 1.86. –ò—â–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—à–µ 2.10.
        </div>
    </div>
</div>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
const themeToggle = document.getElementById('theme-toggle');
themeToggle.addEventListener('change', function() {
    document.body.setAttribute('data-theme', this.checked ? 'light' : 'dark');
});

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤–≤–æ–¥–∞
document.getElementById('inputType').addEventListener('change', function() {
    const type = this.value;
    document.getElementById('pointsInput').style.display = type === 'points' ? 'flex' : 'none';
    document.getElementById('gamesInput').style.display = type === 'games' ? 'flex' : 'none';
});

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
document.querySelectorAll('.score-input').forEach(input => {
    input.addEventListener('focus', function(e) {
        e.preventDefault();
        this.blur();
    });
});

// –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
let activeInput = null;
const scoreInputs = document.querySelectorAll('.score-input');
scoreInputs.forEach(input => {
    input.addEventListener('click', function() {
        activeInput = this;
    });
});

document.querySelectorAll('.key').forEach(key => {
    if (key.id !== 'resetScore') {
        key.addEventListener('click', function() {
            if (activeInput) {
                const value = this.getAttribute('data-value');
                activeInput.value = activeInput.value === '0' ? value : activeInput.value + value;
            }
        });
    }
});

document.getElementById('resetScore').addEventListener('click', function() {
    if (activeInput) activeInput.value = '0';
});

// –†–∞—Å—á–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤—ã–∏–≥—Ä—ã—à–∞ –≥–µ–π–º–∞
function gameWinProb(p) {
    if (p >= 0.999) return 1;
    if (p <= 0.001) return 0;
    const q = 1 - p;
    const p4 = p ** 4;
    const winWithoutDeuce = p4 * (1 + 4 * q + 10 * q * q);
    const goDeuce = 20 * p ** 3 * q ** 3;
    const probDeuce = (p * p) / (p * p + q * q);
    return winWithoutDeuce + goDeuce * probDeuce;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Ç–∞
function isFinal(i, j) {
    return (i >= 6 && j >= 6 && Math.abs(i - j) >= 2) || 
           (i >= 6 && i - j >= 2) || 
           (j >= 6 && j - i >= 2);
}

// –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—Å—á–µ—Ç
function calculateProbabilities() {
    const inputType = document.getElementById('inputType').value;
    let pg1, pg2;
    
    if (inputType === 'points') {
        const p1Serve = parseFloat(document.getElementById('p1Serve').value);
        const p2Serve = parseFloat(document.getElementById('p2Serve').value);
        pg1 = gameWinProb(p1Serve);
        pg2 = gameWinProb(p2Serve);
    } else {
        pg1 = parseFloat(document.getElementById('pg1').value);
        pg2 = parseFloat(document.getElementById('pg2').value);
    }
    
    const a = parseInt(document.getElementById('score1').value);
    const b = parseInt(document.getElementById('score2').value);
    
    if (isNaN(pg1) || isNaN(pg2) || isNaN(a) || isNaN(b)) {
        alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è");
        return;
    }
    
    if (isFinal(a, b)) {
        const total = a + b;
        displayResults(total >= 18 ? 1 : 0, total >= 19 ? 1 : 0, total >= 20 ? 1 : 0);
        return;
    }
    
    const maxGames = a + b + 30;
    let states = {[`${a},${b}`]: 1};
    let finalProbs = {};
    
    for (let totalGames = a + b; totalGames <= maxGames; totalGames++) {
        const nextStates = {};
        let hasStates = false;
        
        for (const stateKey in states) {
            const [i, j] = stateKey.split(',').map(Number);
            const pState = states[stateKey];
            
            if (isFinal(i, j)) {
                finalProbs[stateKey] = (finalProbs[stateKey] || 0) + pState;
                continue;
            }
            
            const p1Win = (totalGames % 2 === 0) ? pg1 : (1 - pg2);
            nextStates[`${i+1},${j}`] = (nextStates[`${i+1},${j}`] || 0) + pState * p1Win;
            nextStates[`${i},${j+1}`] = (nextStates[`${i},${j+1}`] || 0) + pState * (1 - p1Win);
            hasStates = true;
        }
        
        if (!hasStates) break;
        states = nextStates;
    }
    
    for (const stateKey in states) {
        finalProbs[stateKey] = (finalProbs[stateKey] || 0) + states[stateKey];
    }
    
    const distTotal = {};
    for (const stateKey in finalProbs) {
        const [i, j] = stateKey.split(',').map(Number);
        const total = i + j;
        distTotal[total] = (distTotal[total] || 0) + finalProbs[stateKey];
    }
    
    let p17 = 0, p18 = 0, p19 = 0;
    for (const total in distTotal) {
        const t = parseInt(total);
        if (t >= 18) p17 += distTotal[total];
        if (t >= 19) p18 += distTotal[total];
        if (t >= 20) p19 += distTotal[total];
    }
    
    displayResults(p17, p18, p19);
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function displayResults(p17, p18, p19) {
    const fair17 = p17 > 0 ? (1 / p17).toFixed(2) : '-';
    const fair18 = p18 > 0 ? (1 / p18).toFixed(2) : '-';
    const fair19 = p19 > 0 ? (1 / p19).toFixed(2) : '-';
    
    const isValue17 = fair17 > 0 && parseFloat(fair17) > 1.65;
    const isValue18 = fair18 > 0 && parseFloat(fair18) > 1.90;
    const isValue19 = fair19 > 0 && parseFloat(fair19) > 2.10;
    
    let recommendation = '';
    if (isValue19) {
        recommendation = `<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –õ—É—á—à–∞—è —Å—Ç–∞–≤–∫–∞: –¢–ë 19.5. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(p19*100).toFixed(1)}%, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∫—ç—Ñ: ${fair19}. –ò—â–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—à–µ 2.10.`;
    } else if (isValue18) {
        recommendation = `<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –°—Ç–∞–≤–∫–∞ –¢–ë 18.5. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(p18*100).toFixed(1)}%, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∫—ç—Ñ: ${fair18}. –ò—â–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—à–µ 1.90.`;
    } else if (isValue17) {
        recommendation = `<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –°—Ç–∞–≤–∫–∞ –¢–ë 17.5. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(p17*100).toFixed(1)}%, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∫—ç—Ñ: ${fair17}. –ò—â–∏—Ç–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—à–µ 1.65.`;
    } else {
        recommendation = `<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ù–µ—Ç —è–≤–Ω—ã—Ö value-—Å—Ç–∞–≤–æ–∫ –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º —Å—á—ë—Ç–µ. –î–æ–∂–¥–∏—Ç–µ—Å—å –±–æ–ª–µ–µ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.`;
    }
    
    document.getElementById('results').innerHTML = `
        <div class="results-grid">
            <div class="result-card ${isValue17 ? 'value' : 'no-value'}">
                <div class="result-title">–¢–æ—Ç–∞–ª 17.5</div>
                <div class="result-value">${(p17*100).toFixed(1)}%</div>
                <div class="result-prob">–ö—ç—Ñ: ${fair17}</div>
                <div class="prob-bar"><div class="prob-fill" style="width:${p17*100}%"></div></div>
            </div>
            <div class="result-card ${isValue18 ? 'value' : 'no-value'}">
                <div class="result-title">–¢–æ—Ç–∞–ª 18.5</div>
                <div class="result-value">${(p18*100).toFixed(1)}%</div>
                <div class="result-prob">–ö—ç—Ñ: ${fair18}</div>
                <div class="prob-bar"><div class="prob-fill" style="width:${p18*100}%"></div></div>
            </div>
            <div class="result-card ${isValue19 ? 'value' : 'neutral'}">
                <div class="result-title">–¢–æ—Ç–∞–ª 19.5</div>
                <div class="result-value">${(p19*100).toFixed(1)}%</div>
                <div class="result-prob">–ö—ç—Ñ: ${fair19}</div>
                <div class="prob-bar"><div class="prob-fill" style="width:${p19*100}%"></div></div>
            </div>
        </div>
        <div class="recommendation">${recommendation}</div>
    `;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.getElementById('calculateBtn').addEventListener('click', calculateProbabilities);
document.getElementById('score1').addEventListener('click', function() { activeInput = this; });
document.getElementById('score2').addEventListener('click', function() { activeInput = this; });
</script>
</body>
</html>
